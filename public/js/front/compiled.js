(function(t){"use strict";var o=function(){var o=null,e=1,n=10,r=10,i={left:0,up:1,right:2,down:3},a={arrow:{left:37,up:38,right:39,down:40}},c=1,s=500,f=0,u=0,l=20,d=10,p=[],v={i:{color:"#0f0",states:[[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]]]},j:{color:"#f00",states:[[[1,1,1,0],[0,0,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,0,0,0],[1,0,0,0],[0,0,0,0]]]},l:{color:"#00f",states:[[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,1,0,0],[0,0,0,0]],[[1,1,1,0],[1,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]]},t:{color:"#00f",states:[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],[[1,1,1,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},s:{color:"#00f",states:[[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},z:{color:"#00f",states:[[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]]]},o:{color:"#00f",states:[[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]]]}},h=null,y=null,k=function(){var t,o,e=0;for(t in v)Math.random()<1/++e&&(o=t);return o},w=function(){var t=k(),o={};return o.type=t,o.position={},o.position.x=3,o.position.y=0,o.rotation=0,o.shape=v[o.type].states[o.rotation],o.move=function(t){switch(t){case i.left:--this.position.x;break;case i.up:--this.position.y;break;case i.right:++this.position.x;break;case i.down:++this.position.y}},o.rotate=function(){++this.rotation,this.rotation>=v[this.type].states.length&&(this.rotation=0),this.shape=v[this.type].states[this.rotation]},o},b=function(t,o){var e,n,r,i;for(e=0;4>e;e++)for(n=0;4>n;n++)if(r=t.position.y+e,i=t.position.x+n,t.shape[e][n]&&o[r][i].blocked)return!0;return!1},m=function(t){var o,e,n,r;for(o=0;4>o;o++)for(e=0;4>e;e++)if(n=t.position.y+o,r=t.position.x+e,t.shape[o][e]&&(n>l-1||r>d-1||0>r))return!1;return!0},x=function(o,e,n){var r=t.extend(!0,{},e);return r.move(o),!m(r,n)||b(r,n)?!1:!0},g=function(o,e){var n=t.extend(!0,{},o);return n.rotate(),!m(n,e)||b(n,e)?!1:!0},A=function(){var t,o,e;for(t=0;l>t;t++){for(e=!0,o=0;d>o;o++)p[t][o].blocked||(e=!1);if(e)return!0}return!1},E=function(){var t,o,e,n=0;for(t=l-1;t>=0;){for(e=!0,o=0;d>o;o++)p[t][o].blocked||(e=!1);e?(D(t),++n):--t}N(n)},D=function(o){var e,n;for(e=o;e>0;e--)p[e]=t.extend(!0,[],p[e-1]);for(n=0;d>n;n++)p[0][n]=Z()},M=function(t){return 50*(11-t)},j=function(t){if("number"!=typeof t)throw new TypeError("setLevel expects a Number argument!");if(e>t||t>n)throw new RangeError("setLevel only accepts levels [1-10]!");c=t,s=M(t),W()},I=function(o,e){return t('div#tetris-container div.tetris-cell[data-row="'+o+'"][data-column="'+e+'"]')},L=function(o,e){return t('div#tetris-next-block-container div.tetris-cell[data-row="'+o+'"][data-column="'+e+'"]')},R=function(){var t,o,e,n;for(t=0;l>t;t++)for(o=0;d>o;o++)e=p[t][o],n=I(t,o),e.blocked?(n.attr("data-blocked","true"),n.attr("data-block-type",e.type)):(n.removeAttr("data-blocked"),n.removeAttr("data-block-type"))},z=function(){var t,o,e,n,r;if(null!==h)for(t=0;4>t;t++)for(o=0;4>o;o++)e=h.position.x+o,n=h.position.y+t,r=I(n,e),h.shape[t][o]&&(r.attr("data-blocked","true"),r.attr("data-block-type",h.type))},B=function(){var t,o,e;if(null!==y)for(t=0;4>t;t++)for(o=0;4>o;o++)e=L(t,o),y.shape[t][o]?(e.attr("data-blocked","true"),e.attr("data-block-type",y.type)):(e.removeAttr("data-blocked"),e.removeAttr("data-block-type"))},C=function(){R(),z(),B()},G=function(){var t,o,e,n;for(t=0;4>t;t++)for(o=0;4>o;o++)e=h.position.y+t,n=h.position.x+o,p[e]&&p[e][n]&&!p[e][n].blocked&&h.shape[t][o]&&(p[e][n].blocked=!0,p[e][n].type=h.type)},N=function(t){switch(u+=t,0>=u?j(1):u>=1&&90>=u?j(Math.floor(1+(u-1)/10)):j(10),t){case 1:f+=40*c;break;case 2:f+=100*c;break;case 3:f+=300*c;break;case 4:f+=1200*c}T(),U(),V()},O=function(){t("#tetris-overlay").show()},P=function(){t("#tetris-overlay").hide()},Q=function(o){t("#tetris-message").text(o),O()},S=function(t){for(var o=""+t;r>o.length;)o="0"+o;return o},T=function(){t("#tetris-current-score").text(S(f))},U=function(){t("#tetris-current-level").text(c)},V=function(){t("#tetris-current-lines").text(u)},q=function(){x(i.down,h,p)?h.move(i.down):(G(),A()&&E(),h=y,y=w(),b(h,p)&&(H(),h=null)),C()},F=function(){try{q()}catch(t){X(),"undefined"!=typeof console?console.log(t,t.message):alert(t.message)}},H=function(){J(),Q("GAME OVER")},J=function(){clearInterval(o)},K=function(){o=setInterval(F,s)},W=function(){J(),K()},X=function(){J(),Q("PAUSED")},Y=function(){K(),P()},Z=function(){return{blocked:!1,type:null}},$=function(){var t,o;for(t=0;l>t;t++)for(p[t]=[],o=0;d>o;o++)p[t][o]=Z()},_=function(){h=w()},to=function(){y=w()},oo=function(t){if(null!==curentBlock)switch(t){case a.arrow.left:x(i.left,h,p)&&(h.move(i.left),C(),W());break;case a.arrow.right:x(i.right,h,p)&&(h.move(i.right),C(),W());break;case a.arrow.up:g(h,p)&&(h.rotate(),C(),W());break;case a.arrow.down:for(;x(i.down,h,p);)h.move(i.down);C(),W()}},eo=function(){t(document).on("keydown",function(t){var o=t.keyCode||t.which;switch(o){case a.arrow.left:case a.arrow.up:case a.arrow.right:case a.arrow.down:t.preventDefault(),oo(o)}})},no=function(){$(),_(),to(),eo()};return{init:function(){t("#tetris-pause").on("click",function(t){t.preventDefault(),X()}),t("#tetris-continue").on("click",function(t){t.preventDefault(),Y()}),no(),Y()}}}();t(document).on("ready",function(){o.init()})})(jQuery);
(function(t){"use strict";var e=function(){var e=null,o=1,n=10,r=10,a={left:0,up:1,right:2,down:3},i={arrow:{left:37,up:38,right:39,down:40}},c=1,s=500,f=0,u=0,l=20,d=10,p=[],v={i:{color:"#0f0",states:[[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]]]},j:{color:"#f00",states:[[[1,1,1,0],[0,0,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,0,0,0],[1,0,0,0],[0,0,0,0]]]},l:{color:"#00f",states:[[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,1,0,0],[0,0,0,0]],[[1,1,1,0],[1,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]]},t:{color:"#00f",states:[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],[[1,1,1,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},s:{color:"#00f",states:[[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},z:{color:"#00f",states:[[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]]]},o:{color:"#00f",states:[[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]]]}},h=null,k=null,m={mainGameArea:[],nextBlockArea:[]},y=function(){var t,e,o=0;for(t in v)Math.random()<1/++o&&(e=t);return e},w=function(){var t=y(),e={};return e.type=t,e.position={},e.position.x=3,e.position.y=0,e.rotation=0,e.shape=v[e.type].states[e.rotation],e.move=function(t){switch(t){case a.left:--this.position.x;break;case a.up:--this.position.y;break;case a.right:++this.position.x;break;case a.down:++this.position.y}},e.rotate=function(){++this.rotation,this.rotation>=v[this.type].states.length&&(this.rotation=0),this.shape=v[this.type].states[this.rotation]},e},b=function(t,e){var o,n,r,a;for(o=0;4>o;o++)for(n=0;4>n;n++)if(r=t.position.y+o,a=t.position.x+n,t.shape[o][n]&&e[r][a].blocked)return!0;return!1},x=function(t){var e,o,n,r;for(e=0;4>e;e++)for(o=0;4>o;o++)if(n=t.position.y+e,r=t.position.x+o,t.shape[e][o]&&(n>l-1||r>d-1||0>r))return!1;return!0},A=function(e,o,n){var r=t.extend(!0,{},o);return r.move(e),!x(r,n)||b(r,n)?!1:!0},g=function(e,o){var n=t.extend(!0,{},e);return n.rotate(),!x(n,o)||b(n,o)?!1:!0},G=function(){var t,e,o;for(t=0;l>t;t++){for(o=!0,e=0;d>e;e++)p[t][e].blocked||(o=!1);if(o)return!0}return!1},B=function(){var t,e,o,n=0;for(t=l-1;t>=0;){for(o=!0,e=0;d>e;e++)p[t][e].blocked||(o=!1);o?(E(t),++n):--t}O(n)},E=function(e){var o,n;for(o=e;o>0;o--)p[o]=t.extend(!0,[],p[o-1]);for(n=0;d>n;n++)p[0][n]=$()},D=function(t){return 50*(11-t)},M=function(t){if("number"!=typeof t)throw new TypeError("setLevel expects a Number argument!");if(o>t||t>n)throw new RangeError("setLevel only accepts levels [1-10]!");c=t,s=D(t),X()},j=function(e,o){return m.mainGameArea[e]===void 0&&(m.mainGameArea[e]=[]),m.mainGameArea[e][o]===void 0&&(m.mainGameArea[e][o]=t('div#tetris-container div.tetris-cell[data-row="'+e+'"][data-column="'+o+'"]')),m.mainGameArea[e][o]},I=function(e,o){return m.nextBlockArea[e]===void 0&&(m.nextBlockArea[e]=[]),m.nextBlockArea[e][o]===void 0&&(m.nextBlockArea[e][o]=t('div#tetris-next-block-container div.tetris-cell[data-row="'+e+'"][data-column="'+o+'"]')),m.nextBlockArea[e][o]},L=function(){var t,e,o,n;for(t=0;l>t;t++)for(e=0;d>e;e++)o=p[t][e],n=j(t,e),o.blocked?(n.attr("data-blocked","true"),n.attr("data-block-type",o.type)):(n.removeAttr("data-blocked"),n.removeAttr("data-block-type"))},R=function(){var t,e,o,n,r;if(null!==h)for(t=0;4>t;t++)for(e=0;4>e;e++)o=h.position.x+e,n=h.position.y+t,r=j(n,o),h.shape[t][e]&&(r.attr("data-blocked","true"),r.attr("data-block-type",h.type))},z=function(){var t,e,o;if(null!==k)for(t=0;4>t;t++)for(e=0;4>e;e++)o=I(t,e),k.shape[t][e]?(o.attr("data-blocked","true"),o.attr("data-block-type",k.type)):(o.removeAttr("data-blocked"),o.removeAttr("data-block-type"))},C=function(){L(),R(),z()},N=function(){var t,e,o,n;for(t=0;4>t;t++)for(e=0;4>e;e++)o=h.position.y+t,n=h.position.x+e,p[o]&&p[o][n]&&!p[o][n].blocked&&h.shape[t][e]&&(p[o][n].blocked=!0,p[o][n].type=h.type)},O=function(t){switch(u+=t,0>=u?M(1):u>=1&&90>=u?M(Math.floor(1+(u-1)/10)):M(10),t){case 1:f+=40*c;break;case 2:f+=100*c;break;case 3:f+=300*c;break;case 4:f+=1200*c}U(),V(),q()},P=function(){t("#tetris-overlay").show()},Q=function(){t("#tetris-overlay").hide()},S=function(e){t("#tetris-message").text(e),P()},T=function(t){for(var e=""+t;r>e.length;)e="0"+e;return e},U=function(){t("#tetris-current-score").text(T(f))},V=function(){t("#tetris-current-level").text(c)},q=function(){t("#tetris-current-lines").text(u)},F=function(){A(a.down,h,p)?h.move(a.down):(N(),G()&&B(),h=k,k=w(),b(h,p)&&(J(),h=null)),C()},H=function(){try{F()}catch(t){Y(),"undefined"!=typeof console?console.log(t,t.message):alert(t.message)}},J=function(){K(),S("GAME OVER")},K=function(){clearInterval(e)},W=function(){e=setInterval(H,s)},X=function(){K(),W()},Y=function(){K(),S("PAUSED")},Z=function(){W(),Q()},$=function(){return{blocked:!1,type:null}},_=function(){var t,e;for(t=0;l>t;t++)for(p[t]=[],e=0;d>e;e++)p[t][e]=$()},te=function(){h=w()},ee=function(){k=w()},oe=function(t){if(null!==h)switch(t){case i.arrow.left:A(a.left,h,p)&&(h.move(a.left),C(),X());break;case i.arrow.right:A(a.right,h,p)&&(h.move(a.right),C(),X());break;case i.arrow.up:g(h,p)&&(h.rotate(),C(),X());break;case i.arrow.down:for(;A(a.down,h,p);)h.move(a.down);C(),X()}},ne=function(){t(document).on("keydown",function(t){var e=t.keyCode||t.which;switch(e){case i.arrow.left:case i.arrow.up:case i.arrow.right:case i.arrow.down:t.preventDefault(),oe(e)}})},re=function(){_(),te(),ee(),ne()};return{init:function(){t("#tetris-pause").on("click",function(t){t.preventDefault(),Y()}),t("#tetris-continue").on("click",function(t){t.preventDefault(),Z()}),re(),Z()}}}();t(document).on("ready",function(){e.init()})})(jQuery);
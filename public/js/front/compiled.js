(function(t){"use strict";var e=function(){var e=null,o=1,n=10,r=10,i={left:0,up:1,right:2,down:3},a={arrow:{left:37,up:38,right:39,down:40}},c=1,u=500,s=0,f=0,l=20,d=10,p=[],v={i:{color:"#0f0",states:[[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]]]},j:{color:"#f00",states:[[[1,1,1,0],[0,0,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,0,0,0],[1,0,0,0],[0,0,0,0]]]},l:{color:"#00f",states:[[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,1,0,0],[0,0,0,0]],[[1,1,1,0],[1,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]]},t:{color:"#00f",states:[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],[[1,1,1,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},s:{color:"#00f",states:[[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},z:{color:"#00f",states:[[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]]]},o:{color:"#00f",states:[[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]]]}},h=null,b=null,k={mainGameArea:[],nextBlockArea:[]},m=function(){var t,e,o=0;for(t in v)Math.random()<1/++o&&(e=t);return e},y=function(){var t=m(),e={};return e.type=t,e.position={},e.position.x=3,e.position.y=0,e.rotation=0,e.shape=v[e.type].states[e.rotation],e.move=function(t){switch(t){case i.left:--this.position.x;break;case i.up:--this.position.y;break;case i.right:++this.position.x;break;case i.down:++this.position.y}},e.rotate=function(){++this.rotation,this.rotation>=v[this.type].states.length&&(this.rotation=0),this.shape=v[this.type].states[this.rotation]},e},w=function(t,e){var o,n,r,i;for(o=0;4>o;o++)for(n=0;4>n;n++)if(r=t.position.y+o,i=t.position.x+n,t.shape[o][n]&&e[r][i].blocked)return!0;return!1},A=function(t){var e,o,n,r;for(e=0;4>e;e++)for(o=0;4>o;o++)if(n=t.position.y+e,r=t.position.x+o,t.shape[e][o]&&(n>l-1||r>d-1||0>r))return!1;return!0},x=function(e,o,n){var r=t.extend(!0,{},o);return r.move(e),!A(r,n)||w(r,n)?!1:!0},g=function(e,o){var n=t.extend(!0,{},e);return n.rotate(),!A(n,o)||w(n,o)?!1:!0},B=function(){var t,e,o;for(t=0;l>t;t++){for(o=!0,e=0;d>e;e++)p[t][e].blocked||(o=!1);if(o)return!0}return!1},E=function(){var t,e,o,n=0;for(t=l-1;t>=0;){for(o=!0,e=0;d>e;e++)p[t][e].blocked||(o=!1);o?(G(t),++n):--t}O(n)},G=function(e){var o,n;for(o=e;o>0;o--)p[o]=t.extend(!0,[],p[o-1]);for(n=0;d>n;n++)p[0][n]=$()},D=function(t){return 50*(11-t)},I=function(t){if("number"!=typeof t)throw new TypeError("setLevel expects a Number argument!");if(o>t||t>n)throw new RangeError("setLevel only accepts levels [1-10]!");c=t,u=D(t),X()},M=function(t,e){return k.mainGameArea[t]===void 0&&(k.mainGameArea[t]=[]),k.mainGameArea[t][e]===void 0&&(k.mainGameArea[t][e]=document.getElementById("tetris-cell-"+t+"-"+e)),k.mainGameArea[t][e]},j=function(t,e){return k.nextBlockArea[t]===void 0&&(k.nextBlockArea[t]=[]),k.nextBlockArea[t][e]===void 0&&(k.nextBlockArea[t][e]=document.getElementById("next-block-cell-"+t+"-"+e)),k.nextBlockArea[t][e]},L=function(){var t,e,o,n;for(t=0;l>t;t++)for(e=0;d>e;e++)o=p[t][e],n=M(t,e),o.blocked?(n.setAttribute("data-blocked","true"),n.setAttribute("data-block-type",o.type)):(n.removeAttribute("data-blocked"),n.removeAttribute("data-block-type"))},R=function(){var t,e,o,n,r;if(null!==h)for(t=0;4>t;t++)for(e=0;4>e;e++)o=h.position.x+e,n=h.position.y+t,r=M(n,o),h.shape[t][e]&&(r.setAttribute("data-blocked","true"),r.setAttribute("data-block-type",h.type))},z=function(){var t,e,o;if(null!==b)for(t=0;4>t;t++)for(e=0;4>e;e++)o=j(t,e),b.shape[t][e]?(o.setAttribute("data-blocked","true"),o.setAttribute("data-block-type",b.type)):(o.removeAttribute("data-blocked"),o.removeAttribute("data-block-type"))},C=function(){L(),R(),z()},N=function(){var t,e,o,n;for(t=0;4>t;t++)for(e=0;4>e;e++)o=h.position.y+t,n=h.position.x+e,p[o]&&p[o][n]&&!p[o][n].blocked&&h.shape[t][e]&&(p[o][n].blocked=!0,p[o][n].type=h.type)},O=function(t){switch(f+=t,0>=f?I(1):f>=1&&90>=f?I(Math.floor(1+(f-1)/10)):I(10),t){case 1:s+=40*c;break;case 2:s+=100*c;break;case 3:s+=300*c;break;case 4:s+=1200*c}U(),V(),q()},P=function(){t("#tetris-overlay").show()},Q=function(){t("#tetris-overlay").hide()},S=function(e){t("#tetris-message").text(e),P()},T=function(t){for(var e=""+t;r>e.length;)e="0"+e;return e},U=function(){t("#tetris-current-score").text(T(s))},V=function(){t("#tetris-current-level").text(c)},q=function(){t("#tetris-current-lines").text(f)},F=function(){x(i.down,h,p)?h.move(i.down):(N(),B()&&E(),h=b,b=y(),w(h,p)&&(J(),h=null)),C()},H=function(){try{F()}catch(t){Y(),"undefined"!=typeof console?console.log(t,t.message):alert(t.message)}},J=function(){K(),S("GAME OVER")},K=function(){clearInterval(e)},W=function(){e=setInterval(H,u)},X=function(){K(),W()},Y=function(){K(),S("PAUSED")},Z=function(){W(),Q()},$=function(){return{blocked:!1,type:null}},_=function(){var t,e;for(t=0;l>t;t++)for(p[t]=[],e=0;d>e;e++)p[t][e]=$()},te=function(){h=y()},ee=function(){b=y()},oe=function(t){if(null!==h)switch(t){case a.arrow.left:x(i.left,h,p)&&(h.move(i.left),C(),X());break;case a.arrow.right:x(i.right,h,p)&&(h.move(i.right),C(),X());break;case a.arrow.up:g(h,p)&&(h.rotate(),C(),X());break;case a.arrow.down:for(;x(i.down,h,p);)h.move(i.down);C(),X()}},ne=function(){t(document).on("keydown",function(t){var e=t.keyCode||t.which;switch(e){case a.arrow.left:case a.arrow.up:case a.arrow.right:case a.arrow.down:t.preventDefault(),oe(e)}})},re=function(){_(),te(),ee(),ne()};return{init:function(){t("#tetris-pause").on("click",function(t){t.preventDefault(),Y()}),t("#tetris-continue").on("click",function(t){t.preventDefault(),Z()}),re(),Z()}}}();t(document).on("ready",function(){e.init()})})(jQuery);
(function(t){"use strict";var o=function(){var o=null,n=10,r={left:0,up:1,right:2,down:3},e={arrow:{left:37,up:38,right:39,down:40}},i=200,a=20,c=10,s=[],f={i:{color:"#0f0",states:[[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]]]},j:{color:"#f00",states:[[[1,1,1,0],[0,0,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,0,0,0],[1,0,0,0],[0,0,0,0]]]},l:{color:"#00f",states:[[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,0,0,0],[1,1,0,0],[0,0,0,0]],[[1,1,1,0],[1,0,0,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]]},t:{color:"#00f",states:[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],[[1,1,1,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},s:{color:"#00f",states:[[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]]},z:{color:"#00f",states:[[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]]]},o:{color:"#00f",states:[[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]]]}},u=null,l=0,p=function(){var t,o,n=0;for(t in f)Math.random()<1/++n&&(o=t);return o},d=function(){var t=p(),o={};return o.type=t,o.position={},o.position.x=3,o.position.y=0,o.rotation=0,o.shape=f[o.type].states[o.rotation],o.move=function(t){switch(t){case r.left:--this.position.x;break;case r.up:--this.position.y;break;case r.right:++this.position.x;break;case r.down:++this.position.y}},o.rotate=function(){++this.rotation,this.rotation>=f[this.type].states.length&&(this.rotation=0),this.shape=f[this.type].states[this.rotation]},o},h=function(t,o){var n,r,e,i;for(n=0;4>n;n++)for(r=0;4>r;r++)if(e=t.position.y+n,i=t.position.x+r,t.shape[n][r]&&o[e][i].blocked)return!0;return!1},v=function(t){var o,n,r,e;for(o=0;4>o;o++)for(n=0;4>n;n++)if(r=t.position.y+o,e=t.position.x+n,t.shape[o][n]&&(r>a-1||e>c-1||0>e))return!1;return!0},y=function(o,n,r){var e=t.extend(!0,{},n);return e.move(o),!v(e,r)||h(e,r)?!1:!0},w=function(o,n){var r=t.extend(!0,{},o);return r.rotate(),!v(r,n)||h(r,n)?!1:!0},k=function(){var t,o,n;for(t=0;a>t;t++){for(n=!0,o=0;c>o;o++)s[t][o].blocked||(n=!1);if(n)return!0}return!1},b=function(){var t,o,n,r=0;for(t=a-1;t>=0;){for(n=!0,o=0;c>o;o++)s[t][o].blocked||(n=!1);n?(m(t),++r):--t}j(r)},m=function(t){var o,n;for(o=t;o>0;o--)s[o]=s[o-1];for(n=0;c>n;n++)s[0][n]=B()},g=function(o,n){return t('div.tetris-cell[data-row="'+o+'"][data-column="'+n+'"]')},x=function(){var t,o,n,r;for(t=0;a>t;t++)for(o=0;c>o;o++)n=s[t][o],r=g(t,o),n.blocked?(r.attr("data-blocked","true"),r.attr("data-block-type",n.type)):(r.removeAttr("data-blocked"),r.removeAttr("data-block-type"))},A=function(){var t,o,n,r,e;if(null!==u)for(e=g(u.position.y,u.position.x),t=0;4>t;t++)for(o=0;4>o;o++)n=u.position.x+o,r=u.position.y+t,e=g(r,n),u.shape[t][o]&&(e.attr("data-blocked","true"),e.attr("data-block-type",u.type))},D=function(){x(),A()},E=function(){var t,o,n,r;for(t=0;4>t;t++)for(o=0;4>o;o++)n=u.position.y+t,r=u.position.x+o,s[n]&&s[n][r]&&!s[n][r].blocked&&u.shape[t][o]&&(s[n][r].blocked=!0,s[n][r].type=u.type)},j=function(t){l+=1e3*t,G()},z=function(){t("#tetris-overlay").show()},I=function(){t("#tetris-overlay").hide()},M=function(o){t("#tetris-message").text(o),z()},C=function(t){for(var o=""+t;n>o.length;)o="0"+o;return o},G=function(){t("#tetris-current-score").text(C(l))},O=function(){y(r.down,u,s)?u.move(r.down):(E(),k()&&b(),u=d(),h(u,s)&&(Q(),u=null)),D()},P=function(){try{O()}catch(t){V(),console.log(t,t.message)}},Q=function(){R(),M("GAME OVER")},R=function(){clearInterval(o)},S=function(){o=setInterval(P,i)},U=function(){R(),S()},V=function(){R(),M("PAUSED")},q=function(){S(),I()},B=function(){return{blocked:!1,type:null}},F=function(){var t,o;for(t=0;a>t;t++)for(s[t]=[],o=0;c>o;o++)s[t][o]=B()},H=function(){u=d()},J=function(t){switch(t){case e.arrow.left:y(r.left,u,s)&&(u.move(r.left),D(),U());break;case e.arrow.right:y(r.right,u,s)&&(u.move(r.right),D(),U());break;case e.arrow.up:w(u,s)&&(u.rotate(),D(),U());break;case e.arrow.down:for(;y(r.down,u,s);)u.move(r.down);D(),U()}},K=function(){t(document).on("keydown",function(t){var o=t.keyCode||t.which;switch(o){case e.arrow.left:case e.arrow.up:case e.arrow.right:case e.arrow.down:t.preventDefault(),J(o)}})},L=function(){F(),H(),K(),console.log("initialized")};return{init:function(){t("#tetris-pause").on("click",function(t){t.preventDefault(),V()}),t("#tetris-continue").on("click",function(t){t.preventDefault(),q()}),L(),q()}}}();t(document).on("ready",function(){o.init()})})(jQuery);